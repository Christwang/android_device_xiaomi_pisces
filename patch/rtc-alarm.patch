commit 935204c1f7d8fa8075cb6cbb985835fc9120cee6
Author: Xuefer <xuefer@gmail.com>
Date:   Fri Apr 3 01:41:38 2015 +0800

    Fix power off alarm, start alarm after rtc boot
    
    Change-Id: Id626cb856c61ec419db5f9694274a8389ab1287a

diff --git a/src/com/android/deskclock/alarms/AlarmStateManager.java b/src/com/android/deskclock/alarms/AlarmStateManager.java
index 412469e..a710717 100755
--- a/packages/apps/DeskClock/src/com/android/deskclock/alarms/AlarmStateManager.java
+++ b/packages/apps/DeskClock/src/com/android/deskclock/alarms/AlarmStateManager.java
@@ -456,6 +456,12 @@ public final class AlarmStateManager extends BroadcastReceiver {
      * @param instance to set state to
      */
     public static void setMissedState(Context context, AlarmInstance instance) {
+        if (isPowerOffAlarm(context)) {
+            context.sendBroadcast(new Intent(ALARM_POWER_OFF_ACTION));
+            AlarmService.startAlarm(context, instance);
+            return;
+        }
+
         LogUtils.v("Setting missed state to instance " + instance.mId);
         // Stop alarm if this instance is firing it
         AlarmService.stopAlarm(context, instance);
@@ -698,9 +704,6 @@ public final class AlarmStateManager extends BroadcastReceiver {
                 break;
             case AlarmInstance.MISSED_STATE:
                 setMissedState(context, instance);
-                if (isPowerOffAlarm(context)) {
-                    context.sendBroadcast(new Intent(ALARM_POWER_OFF_ACTION));
-                }
                 break;
             case AlarmInstance.DISMISSED_STATE:
                 setDismissState(context, instance);
