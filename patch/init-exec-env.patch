commit fe257a134fb19b26c5e7dfd04ac9470987e2f096
Author: Xuefer <xuefer@gmail.com>
Date:   Thu Mar 26 15:32:55 2015 +0800

    init: suppprt exported env for exec
    
    Change-Id: I0b57786a1fe4fba23ddd351048499753bb759bb1

diff --git a/init/builtins.c b/init/builtins.c
index 10a810e..1823ebf 100644
--- a/system/core/init/builtins.c
+++ b/system/core/init/builtins.c
@@ -48,6 +48,7 @@
 #include "log.h"
 
 #include <private/android_filesystem_config.h>
+extern const char *ENV[];
 
 int add_environment(const char *name, const char *value);
 
@@ -301,10 +302,13 @@ int do_exec(int nargs, char **args)
     {
         char tmp[32];
         int fd, sz;
-        get_property_workspace(&fd, &sz);
-        sprintf(tmp, "%d,%d", dup(fd), sz);
-        setenv("ANDROID_PROPERTY_WORKSPACE", tmp, 1);
-        execve(par[0], par, environ);
+        if (properties_inited()) {
+            get_property_workspace(&fd, &sz);
+            sprintf(tmp, "%d,%d", dup(fd), sz);
+            add_environment("ANDROID_PROPERTY_WORKSPACE", tmp);
+        }
+
+        execve(par[0], par, (char **) ENV);
         exit(0);
     }
     else
diff --git a/init/init.c b/init/init.c
index 7a68e62..978b879 100644
--- a/system/core/init/init.c
+++ b/system/core/init/init.c
@@ -97,7 +97,7 @@ static int have_console;
 static char console_name[PROP_VALUE_MAX] = "/dev/console";
 static time_t process_needs_restart;
 
-static const char *ENV[32];
+const char *ENV[32];
 
 static unsigned charging_mode = 0;
 
